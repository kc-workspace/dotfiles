# shellcheck disable=SC1091,SC2148

## Required:
##   - starship
##   - zinit

## Setup zsh history
setopt histignorealldups sharehistory
export HISTSIZE=1000
export SAVEHIST=1000
export HISTFILE="$HOME/.zsh_history"

## Setup zdharma-continuum/zinit
ZINIT_HOME="$HOME/.local/share/zinit/zinit.git"
source "$ZINIT_HOME/zinit.zsh"

## Setup starship prompt
## https://starship.rs
zinit ice as"command" from"gh-r" \
  atclone"./starship init zsh > init.zsh; ./starship completions zsh > _starship" \
  atpull"%atclone" src"init.zsh"
zinit light starship/starship

## Setup completions settings
zstyle ':completion:*' menu select
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zcompcache

## Setup autocompletions
## https://github.com/marlonrichert/zsh-autocomplete
# zinit ice blockf atload"
# bindkey -M menuselect '^I' menu-complete
# "
# zinit light marlonrichert/zsh-autocomplete

## Setup completions definitions
## https://github.com/zsh-users/zsh-completions
# zinit ice blockf
# zinit light zsh-users/zsh-completions

## Setup autosuggestions
## https://github.com/zsh-users/zsh-autosuggestions
zinit ice atinit"
export ZSH_AUTOSUGGEST_STRATEGY=(atuin completion)
"
zinit light zsh-users/zsh-autosuggestions

## Setup vim mode
## https://github.com/jeffreytse/zsh-vi-mode
zinit light jeffreytse/zsh-vi-mode

## Setup substring history search
## https://github.com/zsh-users/zsh-history-substring-search
zinit ice wait lucid atinit"
export HISTORY_SUBSTRING_SEARCH_PREFIXED=true
export HISTORY_SUBSTRING_SEARCH_HIGHLIGHT_TIMEOUT=3
" atload"
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down"
zinit load zsh-users/zsh-history-substring-search

## Setup atuin
## https://github.com/atuinsh/atuin
zinit ice wait lucid as"command" from"gh-r" bpick"atuin-*.tar.gz" mv"atuin*/atuin -> atuin" \
  atclone"./atuin init zsh --disable-up-arrow > init.zsh; ./atuin gen-completions --shell zsh > _atuin" \
  atpull"%atclone" src"init.zsh" pick"atuin"
zinit light atuinsh/atuin

## Setup zoxide - cd alternative command
## https://github.com/ajeetdsouza/zoxide
zinit ice wait lucid as"command" from"gh-r" bpick"zoxide-*.tar.gz" \
  atclone"./zoxide init zsh > init.zsh" \
  atpull"%atclone" src"init.zsh"
zinit light ajeetdsouza/zoxide

## Setup fd - find alternative command
## https://github.com/sharkdp/fd
zinit ice wait lucid as"command" from"gh-r" bpick"fd-*.tar.gz" \
  pick"fd-*/fd"
zinit light sharkdp/fd

## Setup lsd - ls alternative command
## https://github.com/lsd-rs/lsd
zinit ice wait lucid as"command" from"gh-r" bpick"lsd-*.tar.gz" \
  pick"lsd-*/lsd"
zinit light lsd-rs/lsd

## Setup nvim - vim alternative command
## https://github.com/neovim/neovim
zinit ice wait lucid as"command" from"gh-r" bpick"nvim-*.tar.gz" \
  pick"bin/nvim"
zinit light neovim/neovim

## Setup wd cli
## https://github.com/mfaerevaag/wd
zinit ice wait lucid as"command" pick"wd.sh" src"wd.plugin.zsh"
zinit light mfaerevaag/wd

## Setup alias tooltip
## https://github.com/decayofmind/zsh-fast-alias-tips
# zinit ice wait lucid from"gh-r" atinit"
# export ZSH_FAST_ALIAS_TIPS_PREFIX='Alias for [$(tput bold)$(tput setaf 1)'
# export ZSH_FAST_ALIAS_TIPS_SUFFIX='$(tput sgr0)]'"
# zinit light decayofmind/zsh-fast-alias-tips

## Setup alias tooltip (ohmyzsh)
## https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/alias-finder
zinit ice wait lucid atinit"
zstyle ':omz:plugins:alias-finder' autoload yes
zstyle ':omz:plugins:alias-finder' longer yes
zstyle ':omz:plugins:alias-finder' cheaper yes"
zinit snippet OMZP::alias-finder

## Setup brew alias and completions
zinit ice wait"1" lucid atload"zicompinit; zicdreplay"
zinit snippet OMZP::brew

## Setup alias and helpers (no completions)
zinit wait"2" lucid for \
  OMZP::thefuck \
  OMZP::git \
  OMZP::colored-man-pages

## Setup macos utilties
## https://github.com/unixorn/tumult.plugin.zsh#included-scripts
## Setup autopair characters
## https://github.com/hlissner/zsh-autopair
zinit wait"2" lucid light-mode for \
  unixorn/tumult.plugin.zsh \
  hlissner/zsh-autopair

## Setup command syntax highlighting
## Must be on the end of zinit script
## https://github.com/zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-syntax-highlighting

## After setup without turbo mode
## We need to use compinit and cdreplay
zicompinit && zicdreplay
