# shellcheck disable=SC1091,SC2148

## Required:
##   - starship
##   - zinit

## Setup zsh history
setopt histignorealldups sharehistory
export HISTSIZE=1000
export SAVEHIST=1000
export HISTFILE="$HOME/.zsh_history"

## Setup zsh completion
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.cache/zsh_completion_cache

## Setup zdharma-continuum/zinit
ZINIT_HOME="$HOME/.local/share/zinit/zinit.git"
source "$ZINIT_HOME/zinit.zsh"

### add alias tips when run full command
### add pair symbol (), {}, [] etc.
### add color to man page
### add thefuck support
### enhance version of ls
### completions collection
### autocomplete dialog
### autosuggestions commands
# zinit wait for \
#   djui/alias-tips \
#   hlissner/zsh-autopair \
#   ael-code/zsh-colored-man-pages \
#   laggardkernel/zsh-thefuck \
#   supercrabtree/k \
#   zsh-users/zsh-autosuggestions

# zi wait for \
#   blockf \
#   atload"zicompinit; zicdreplay" \
#   marlonrichert/zsh-autocomplete
#   blockf \
#   atload"zicompinit; zicdreplay" \
#   zsh-users/zsh-completions

### Setup wd cli
# zinit ice as"program" pick"wd.sh" src"wd.plugin.zsh"
# zinit load "mfaerevaag/wd"

## Setup atuin
# zinit ice as"command" from"gh-r" bpick"atuin-*.tar.gz" mv"atuin*/atuin -> atuin" \
#   atclone"./atuin init zsh > init.zsh; ./atuin gen-completions --shell zsh > _atuin" \
#   atpull"%atclone" src"init.zsh"
# zinit light atuinsh/atuin

## Setup starship prompt
## https://starship.rs
zinit ice as"command" from"gh-r" \
  atclone"./starship init zsh > init.zsh; ./starship completions zsh > _starship" \
  atpull"%atclone" src"init.zsh"
zinit light starship/starship

## Setup autocompletions
## https://github.com/marlonrichert/zsh-autocomplete
zinit ice blockf \
  atload"
bindkey '^[[A' .history-search-backward;
bindkey '^[[B' .history-search-forward;
bindkey -M menuselect '^I' menu-complete;
bindkey -M menuselect '$terminfo[kcbt]' reverse-menu-complete;"
zinit light marlonrichert/zsh-autocomplete

## After setup without turbo mode
## We need to use compinit and cdreplay
zicompinit && zicdreplay

## Setup command syntax highlighting
zinit ice wait lucid
zinit light zdharma-continuum/fast-syntax-highlighting

## Setup wd cli
## https://github.com/mfaerevaag/wd
zinit ice wait lucid \
  as"command" pick"wd.sh" src"wd.plugin.zsh"
zinit light mfaerevaag/wd

## Setup macos utilties
## https://github.com/unixorn/tumult.plugin.zsh#included-scripts
zinit ice wait"3" lucid
zinit light unixorn/tumult.plugin.zsh

## Setup home bin
home_bin="$HOME/bin"
if [ -d "$home_bin" ]; then
  PATH="$PATH:$home_bin"
fi
unset home_bin

## Setup mise
mise="$HOME/.local/bin/mise"
if [ -f "$mise" ]; then
  eval "$("$mise" activate zsh)"
fi
unset mise

## Setup docker cli
docker_bin="$HOME/.docker/bin"
if [ -d "$docker_bin" ]; then
  PATH="$PATH:$docker_bin"
fi
unset docker_bin

## Setup homebrew
export HOMEBREW_NO_ANALYTICS=1
## Setup homebrew auto-completion
brew_comp="/opt/homebrew/share/zsh/site-functions"
if [ -d "$docker_bin" ]; then
  fpath+=("$brew_comp")
fi
unset brew_comp
