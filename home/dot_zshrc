# shellcheck disable=SC1091,SC2148

## Required:
##   - starship
##   - zinit

## Setup zsh history
setopt histignorealldups sharehistory
export HISTSIZE=1000
export SAVEHIST=1000
export HISTFILE="$HOME/.zsh_history"

## Setup zsh completion
zstyle ':completion:*' menu select
# zstyle ':completion:*' use-cache on
# zstyle ':completion:*' cache-path ~/.cache/zsh_completion_cache

## Setup zdharma-continuum/zinit
ZINIT_HOME="$HOME/.local/share/zinit/zinit.git"
source "$ZINIT_HOME/zinit.zsh"

## Setup starship prompt
## https://starship.rs
zinit ice as"command" from"gh-r" \
  atclone"./starship init zsh > init.zsh; ./starship completions zsh > _starship" \
  atpull"%atclone" src"init.zsh"
zinit light starship/starship

## Setup autocompletions
## https://github.com/marlonrichert/zsh-autocomplete
# zinit ice blockf atload"
# bindkey -M emacs '^[[A' .history-search-backward;
# bindkey -M emacs '^[[B' .history-search-forward;
# bindkey -M menuselect '\t' menu-complete
# bindkey -M menuselect '^[[A' up-line-or-search;
# bindkey -M menuselect '^[[B' down-line-or-select;
# "
# zinit light marlonrichert/zsh-autocomplete

## Setup completions definitions
## https://github.com/zsh-users/zsh-completions
# zinit ice blockf
# zinit light zsh-users/zsh-completions

## Setup autosuggestions
## https://github.com/zsh-users/zsh-autosuggestions
zinit ice atinit"
export ZSH_AUTOSUGGEST_STRATEGY=(atuin completion)
"
zinit light zsh-users/zsh-autosuggestions

## Setup substring history search
## https://github.com/zsh-users/zsh-history-substring-search
zinit ice wait lucid atinit"
export HISTORY_SUBSTRING_SEARCH_PREFIXED=true
export HISTORY_SUBSTRING_SEARCH_HIGHLIGHT_TIMEOUT=3
" atload"
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down"
zinit load zsh-users/zsh-history-substring-search

## Setup atuin
## https://github.com/atuinsh/atuin
zinit ice wait lucid as"command" from"gh-r" bpick"atuin-*.tar.gz" mv"atuin*/atuin -> atuin" \
  atclone"./atuin init zsh --disable-up-arrow > init.zsh; ./atuin gen-completions --shell zsh > _atuin" \
  atpull"%atclone" src"init.zsh"
zinit light atuinsh/atuin

## Setup wd cli
## https://github.com/mfaerevaag/wd
zinit ice wait lucid as"command" pick"wd.sh" src"wd.plugin.zsh"
zinit light mfaerevaag/wd

## Setup alias tooltip
## https://github.com/decayofmind/zsh-fast-alias-tips
zinit ice wait lucid from"gh-r" atinit"
export ZSH_FAST_ALIAS_TIPS_PREFIX='Alias for [$(tput bold)$(tput setaf 1)'
export ZSH_FAST_ALIAS_TIPS_SUFFIX='$(tput sgr0)]'"
zinit light decayofmind/zsh-fast-alias-tips

zinit wait"2" lucid for \
  OMZP::brew \
  OMZP::thefuck

## Setup macos utilties
## https://github.com/unixorn/tumult.plugin.zsh#included-scripts
## Setup colored man pages
## https://github.com/ael-code/zsh-colored-man-pages
zinit wait"3" lucid light-mode for \
  unixorn/tumult.plugin.zsh \
  ael-code/zsh-colored-man-pages \
  hlissner/zsh-autopair

## Setup command syntax highlighting
## Must be on the end of zinit script
## https://github.com/zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-syntax-highlighting

## After setup without turbo mode
## We need to use compinit and cdreplay
zicompinit && zicdreplay
